<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WISC Security Industry Survey – Crosstabs + Verbatims</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <style>
    :root {
      --royal-purple: #7434ac;
      --purple: #98069d;
      --gray: #6b7280;
      --light-bg: #f9fafb;
    }
    body {
      margin: 0;
      background: #f5f3f7;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
      color: #111;
    }
    .wrap { max-width: 1680px; margin: 0 auto; padding: 20px; }
    .main-header {
      background: white; border-radius: 12px; padding: 20px; margin-bottom: 16px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .logo-section { display:flex; align-items:center; gap:20px; border-bottom:2px solid #eee; padding-bottom:12px; }
    .logo-section img { max-width:160px; }
    .tabbar { display:flex; gap:10px; margin-top:16px; }
    .tab { background:#f3f4f6; padding:10px 18px; border-radius:8px; font-weight:600; cursor:pointer; }
    .tab.active { background:linear-gradient(135deg,var(--royal-purple),var(--purple)); color:white; }
    .controls { background:white; border-radius:12px; padding:16px; margin-bottom:16px;
                box-shadow:0 2px 8px rgba(0,0,0,0.1); }
    .control-row { display:flex; flex-wrap:wrap; gap:12px; margin-bottom:12px; align-items:center; }
    .btn { background:var(--royal-purple); color:white; border:none; border-radius:8px;
           padding:8px 14px; font-weight:600; cursor:pointer; }
    .btn.secondary { background:#6b7280; }
    .btn.success { background:#10b981; }
    .btn:hover { background:#5a2a8a; }
    .status { display:none; padding:10px; margin-bottom:12px; border-radius:8px; }
    .twrap { background:white; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.08); margin-bottom:16px; }
    .thead { background:linear-gradient(135deg,var(--royal-purple),var(--purple)); color:white;
             padding:10px 16px; font-weight:600; border-radius:12px 12px 0 0; }
    /* Verbatims */
    .stats-container { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:12px; margin-bottom:16px; }
    .stat-card { background:white; border-radius:12px; padding:14px; text-align:center;
                 box-shadow:0 1px 4px rgba(0,0,0,0.1); border-top:4px solid var(--royal-purple); }
    .stat-number { font-size:24px; font-weight:700; color:var(--royal-purple); }
    .stat-label { font-size:12px; text-transform:uppercase; color:var(--gray); }
    .responses { display:grid; gap:14px; }
    .card { background:white; border-radius:12px; padding:16px;
            box-shadow:0 1px 6px rgba(0,0,0,0.08); border-left:5px solid var(--royal-purple); }
    .card .hdr { display:flex; justify-content:space-between; margin-bottom:8px; flex-wrap:wrap; }
    .badge { padding:4px 10px; border-radius:999px; font-size:12px; font-weight:600; color:white; }
    .b-ext { background:linear-gradient(135deg,var(--royal-purple),var(--purple)); }
    .b-very { background:#9454b0; }
    .b-some { background:#e4a324; }
    .b-not2 { background:#eb0473; }
    .b-not1 { background:#f10b25; }
    .quote { font-style:italic; background:var(--light-bg); padding:10px; border-radius:8px; }
    .pill { font-size:11px; color:#374151; background:#f3f4f6; border:1px solid #e5e7eb;
            padding:4px 8px; border-radius:999px; margin:2px; display:inline-block; }
    .tabpane { display:none; }
    .tabpane.active { display:block; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="main-header">
      <div class="logo-section">
        <img src="https://i.imgur.com/nefMHjP.png" alt="Beyond Insights">
        <div>
          <h1 style="margin:0;color:#4c2a85">WISC Security Industry Survey</h1>
          <p style="margin:0;color:#6b7280">Crosstabs + Verbatims Tool</p>
        </div>
      </div>
      <div class="tabbar">
        <button class="tab active" data-tab="tab-xtabs">Crosstabs</button>
        <button class="tab" data-tab="tab-verbatims">Verbatims</button>
      </div>
    </div>

    <!-- Crosstabs -->
    <div id="tab-xtabs" class="tabpane active">
      <div class="controls">
        <div class="control-row">
          <label>Banner</label>
          <select id="bannerSel">
            <option value="B1">BANNER 1 – Demographics & Experience</option>
            <option value="B2">BANNER 2 – Perceptions (Women Only)</option>
          </select>
          <label>Question</label>
          <select id="qSel"></select>
        </div>
        <div class="control-row">
          <button class="btn" id="genBtn">Generate Table</button>
          <button class="btn success" id="allFullBtn">Generate All Tables</button>
          <button class="btn danger" id="clearBtn">Clear Tables</button>
          <button class="btn secondary" id="exportBtn">Export to Excel</button>
          <button class="btn" id="bbBtn" style="background:#8b5cf6">Banner × Banner</button>
          <button class="btn secondary" onclick="window.open('survey.pdf','_blank')">Review Survey</button>
          <button class="btn secondary" onclick="window.location.href='survey.pdf'" download>⬇ Download Survey</button>
          <button class="btn secondary" onclick="window.open('report.html','_blank')">Review Report</button>
        </div>
      </div>
      <div id="tables"></div>
    </div>

    <!-- Verbatims -->
    <div id="tab-verbatims" class="tabpane">
      <div class="controls">
        <div class="control-row">
          <input type="text" id="qSearch" placeholder="Search responses…" style="flex:1;padding:8px;border:1px solid #ddd;border-radius:6px;">
          <select id="satFilter">
            <option value="all">All</option>
            <option value="_05">Extremely satisfied</option>
            <option value="_04">Very satisfied</option>
            <option value="_03">Somewhat satisfied</option>
            <option value="_02">Not too satisfied</option>
            <option value="_01">Not at all satisfied</option>
          </select>
          <button class="btn" id="refreshOE">Refresh</button>
        </div>
      </div>
      <div class="stats-container">
        <div class="stat-card"><div class="stat-number" id="oeTotal">0</div><div class="stat-label">Total Responses</div></div>
        <div class="stat-card"><div class="stat-number" id="oeShown">0</div><div class="stat-label">Currently Shown</div></div>
      </div>
      <div class="responses" id="oeList"><div class="card"><div class="quote">Loading responses…</div></div></div>
    </div>
  </div>

  <!-- Banner × Banner Modal -->
  <div class="modal-backdrop" id="bbModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.35);align-items:center;justify-content:center;z-index:9999;">
    <div class="modal" style="background:white;width:min(900px,90vw);border-radius:12px;box-shadow:0 10px 50px rgba(0,0,0,.25);">
      <div class="modal-h" style="padding:14px 16px;border-bottom:1px solid #eee;font-weight:800;">Banner × Banner Crosstab</div>
      <div class="modal-b" style="padding:16px;">
        <label>Columns</label><select id="bbCols"></select>
        <label>Rows</label><select id="bbRows"></select>
        <div id="bbOut" style="margin-top:10px;"></div>
      </div>
      <div class="modal-f" style="padding:12px 16px;border-top:1px solid #eee;display:flex;gap:10px;justify-content:flex-end;">
        <button class="btn secondary" id="bbClose">Close</button>
        <button class="btn success" id="bbRun">Run</button>
      </div>
    </div>
  </div>

  <script>
    let DATA=[],OE=[];
    const DEFAULTS={csv:'data/condensed_datafile.csv',oe:'data/openends.csv'};
    const MAP_Q1={'_05':'Extremely satisfied','_04':'Very satisfied','_03':'Somewhat satisfied','_02':'Not too satisfied','_01':'Not at all satisfied'};

    // load crosstab data
    fetch(DEFAULTS.csv).then(r=>r.text()).then(t=>{
      DATA=Papa.parse(t,{header:true,skipEmptyLines:true}).data;
      initQuestions();
    });
    // load openends
    fetch(DEFAULTS.oe).then(r=>r.text()).then(t=>{
      OE=Papa.parse(t,{header:true,skipEmptyLines:true}).data;
      renderVerbatims();
    });

    function initQuestions(){
      const qs=[{code:'S1',title:'S1. Gender Identity'},{code:'Q1',title:'Q1. Overall Job Satisfaction'}];
      const qSel=document.getElementById('qSel');
      qSel.innerHTML=qs.map(q=>`<option value="${q.code}">${q.title}</option>`).join('');
    }
    function renderTable(code){document.getElementById('tables').innerHTML=`<div class="twrap"><div class="thead">${code}</div></div>`;}

    document.getElementById('genBtn').onclick=()=>renderTable(document.getElementById('qSel').value);
    document.getElementById('allFullBtn').onclick=()=>renderTable('ALL');
    document.getElementById('clearBtn').onclick=()=>{document.getElementById('tables').innerHTML='';};

    // Banner × Banner
    function openBB(){document.getElementById('bbModal').style.display='flex';}
    function closeBB(){document.getElementById('bbModal').style.display='none';}
    function populateBBSelectors(){['bbCols','bbRows'].forEach(id=>{document.getElementById(id).innerHTML='<option>B1</option><option>B2</option>';});}
    function runBB(){document.getElementById('bbOut').innerHTML='<div class="twrap"><div class="thead">Banner × Banner Output</div></div>'; }
    document.getElementById('bbBtn').onclick=()=>{populateBBSelectors();openBB();};
    document.getElementById('bbClose').onclick=closeBB;
    document.getElementById('bbRun').onclick=runBB;

    // Verbatims
    function renderVerbatims(){
      let rows=[...OE];
      const sat=document.getElementById('satFilter').value;
      const search=(document.getElementById('qSearch').value||'').toLowerCase();
      if(sat!=='all') rows=rows.filter(r=>r.Q1===sat);
      if(search) rows=rows.filter(r=>(r.Q2||'').toLowerCase().includes(search));
      document.getElementById('oeTotal').innerText=OE.length;
      document.getElementById('oeShown').innerText=rows.length;
      document.getElementById('oeList').innerHTML=rows.map(r=>{
        const badgeMap={'_05':['Extremely','b-ext'],'_04':['Very','b-very'],'_03':['Somewhat','b-some'],'_02':['Not too','b-not2'],'_01':['Not at all','b-not1']};
        const [lab,cls]=badgeMap[r.Q1]||['',''];
        return `<div class="card">
          <div class="hdr"><div class="pill">ID ${r['Respondent.Serial']||''}</div><div class="badge ${cls}">${lab}</div></div>
          <div class="quote">${r.Q2||''}</div>
        </div>`;
      }).join('');
    }
    document.getElementById('refreshOE').onclick=renderVerbatims;

    // Tabs
    document.querySelectorAll('.tab').forEach(btn=>{
      btn.onclick=()=>{
        document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
        btn.classList.add('active');
        document.querySelectorAll('.tabpane').forEach(p=>p.classList.remove('active'));
        document.getElementById(btn.dataset.tab).classList.add('active');
      };
    });
  </script>
</body>
</html>
